{% extends 'general_templates/general_layout.html' %}

{% block body %}
<div class="container mt-4">
    <h2>Chat de Soporte TÃ©cnico</h2>
    <div class="chat-container">
        <div id="chat-messages" class="chat-messages"></div>
        <div class="chat-input">
            <input type="text" id="chat-input" placeholder="Escribe un mensaje...">
            <button id="chat-send">Enviar</button>
        </div>
    </div>
</div>

<script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
<script>

    const room = 'usuarios';
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const chatSend = document.getElementById('chat-send');

    socket.emit('join', { room: room });

    socket.on('receive_message', function(data) {
        const messageElement = document.createElement('div');
        messageElement.classList.add('message');
        messageElement.innerHTML = `<strong>${data.username}:</strong> ${data.message}`;
        chatMessages.appendChild(messageElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    });

    chatSend.addEventListener('click', function() {
        sendMessage();
    });

    chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    function sendMessage() {
        const message = chatInput.value.trim();
        if (message) {
            socket.emit('send_message', { room: room, message: message, username: '{{ current_user.username }}' });
            chatInput.value = '';
        }
    }
</script>

{% endblock %}